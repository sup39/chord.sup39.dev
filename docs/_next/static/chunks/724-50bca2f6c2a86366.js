"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[724],{652:function(t,e,n){n.d(e,{Z:function(){return l}});var r=n(5893);let o=new Proxy([{color:"white",x:0},{color:"black",x:13},{color:"white",x:22.5},{color:"black",x:40},{color:"white",x:45},{color:"white",x:67.5},{color:"black",x:79.5},{color:"white",x:90},{color:"black",x:105.5},{color:"white",x:112.5},{color:"black",x:131.5},{color:"white",x:135}].map(t=>({...t,..."white"===t.color?{w:22.5,h:75}:{w:14,h:47.5}})),{get(t,e){if("symbol"==typeof e)return;let n=parseInt(e),r=t[n%12];return{...r,x:r.x+157.5*Math.floor(n/12)}}});function l(t){let{base:e=0,keyCount:n=24,points:l=[],shiftPoints:c=!0,margin:a=10,strokeWidth:i=1,pointColor:u="#f9f",whiteColor:s="#eee",blackColor:f="#000",whiteStroke:h="#000"}=t,d=Array.from({length:n},(t,n)=>o[e+n]),m=d[d.length-1],p=d[0].x,x=m.x+m.w-p;if(c){let g=Math.min(...l),b=12*Math.floor((g-e)/12);l=l.map(t=>t-b)}return(0,r.jsxs)("svg",{viewBox:"".concat(p-a," ").concat(-a," ").concat(x+2*a," ").concat(75+2*a),children:[d.filter(t=>"white"===t.color).map(t=>(0,r.jsx)("rect",{x:t.x,y:0,width:t.w,height:t.h,fill:s,stroke:h,strokeWidth:i},"w"+t.x)),d.filter(t=>"black"===t.color).map(t=>(0,r.jsx)("rect",{x:t.x,y:0,width:t.w,height:t.h,fill:f},"b"+t.x)),l.map(t=>{let{x:e,w:n,h:l}=o[t];return(0,r.jsx)("circle",{cx:e+n/2,cy:l-12,r:4,fill:u},"c"+t)})]})}},2962:function(t,e,n){n.d(e,{Z:function(){return r}});var r=(0,n(4625).f)({site:{startYear:2023,author:"サポミク",title:"サポミク",subtitle:"和音練習",icon:"https://res.sup39.dev/icon.svg"},metaFields:[{attr:"author",label:"作者："},{attr:"createdAt",label:"作成日時："},{attr:"updatedAt",label:"更新日時："}],nav:[{label:"カスタマイズ練習",path:"customized"}]})},5508:function(t,e,n){n.d(e,{Z:function(){return h}});var r=n(5893),o=n(652),l=n(931),c=n(7294),a=n(541),i=n(2581),u=n(9367);let s={totalCount:0,correctCount:0,totalTimeC:0},f={correctCount:0,totalCount:0,notes:[],correct:!0,totalTimeC:0};function h(t){let{questionGeneratorRef:e,lskeyPrefix:n}=t,h=null==n?null:n+"stats",d=(0,c.useRef)(new l.$),m=(0,c.useRef)(a.TY),p=m.current,[x,g]=(0,c.useState)(f),b=(0,c.useRef)(0),[v,w]=(0,c.useState)(0),C=(0,c.useRef)(NaN),j=(0,c.useRef)(),k=(0,c.useRef)(()=>{g(t=>{var n;return null==t.correct?t:(d.current.notes.clear(),m.current=e.current(),b.current=+new Date,null===(n=j.current)||void 0===n||n.emit("state",{timer:null}),!function t(){let e=+new Date;w(e-b.current),C.current=requestAnimationFrame(t)}(),{...t,totalCount:t.totalCount+1,notes:[],correct:null})})});return(0,c.useEffect)(()=>{let t=d.current;function e(t){if(3!==t.byteLength)return;let e=d.current,[n,r,o]=t;if(128===n){e.noteOff(r);return}if(144===n)e.noteOn(r);else{if(176!==n)return;e.pedal(r,o)}}t.callback={noteChanged(){g(e=>{let{notes:n}=t;if(null!=e.correct)return e;let r=m.current.check(n),o={totalCount:e.totalCount,correctCount:e.correctCount,totalTimeC:e.totalTimeC};if(null!=r){var l;cancelAnimationFrame(C.current);let c=+new Date-b.current;w(c),null===(l=j.current)||void 0===l||l.emit("state",{timer:c}),r&&(o.correctCount++,o.totalTimeC+=c),h&&localStorage.setItem(h,JSON.stringify(o))}return{...o,notes:Array.from(n),correct:r}})},pedalOn(t){66===t&&k.current()}};let n=new URLSearchParams(window.location.search).get("midi");if(null!=n){let r=(0,u.io)(n,{reconnection:!1});r.on("connect",()=>{console.log("Connected"),r.on("midi",t=>e(new Uint8Array(t)))}),r.on("connect_error",t=>{alert("Fail to connect to ".concat(n)),console.error(t)}),j.current=r}else(0,l.r)().then(t=>{let[r]=t;if(null==r){null==n&&alert("MIDI not found");return}r.onmidimessage=t=>{let{data:n}=t;return e(n)},g(t=>({...t,...null!=h?(0,i.i)(h,s):{}}))});document.addEventListener("keydown",t=>{" "===t.key&&k.current()})},[h]),(0,c.useEffect)(()=>{var t;null===(t=j.current)||void 0===t||t.emit("state",{...x,...p})},[x,p]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("section",{children:[(0,r.jsx)("div",{className:"Prompt",children:(0,r.jsxs)("span",{children:[x.correctCount," ","/"," ",x.totalCount]})}),(0,r.jsxs)("div",{children:["平均時間：",0===x.correctCount?"N/A":(x.totalTimeC/x.correctCount/1e3).toFixed(3)+"秒"]}),(0,r.jsxs)("div",{children:["回答時間：",(v/1e3).toFixed(3),"秒"]}),(0,r.jsx)("div",{className:"Prompt",children:p.prompt})]}),(0,r.jsxs)("section",{children:[""===p.prompt||null!=x.correct?(0,r.jsx)("button",{onClick:()=>k.current(),children:"Next"}):(0,r.jsx)(r.Fragment,{}),(0,r.jsx)("h4",{children:"回答"}),(0,r.jsx)(o.Z,{points:x.notes,pointColor:"#66f",shiftPoints:!0})]}),p.prompt&&null!=x.correct&&(0,r.jsxs)("section",{children:[(0,r.jsx)("h4",{children:x.correct?"正解！":"不正解"}),(0,r.jsx)(o.Z,{points:p.solution,pointColor:"#f9f",shiftPoints:!0})]}),(0,r.jsx)("button",{className:"danger",onClick:function(){window.confirm("本当にリセットしますか？")&&(null!=h&&localStorage.setItem(h,JSON.stringify(s)),m.current=a.TY,cancelAnimationFrame(C.current),w(0),g({...f}))},children:"リセット"})]})}},2581:function(t,e,n){n.d(e,{i:function(){return r}});function r(t,e){var n;if("undefined"==typeof localStorage)return e;let r=function(t){try{return JSON.parse(t)}catch(e){return}}(localStorage.getItem(t));return null==r||"object"!=typeof r?e:Object.fromEntries(Object.entries(e).map(t=>{let[e,o]=t;return[e,null!==(n=r[e])&&void 0!==n?n:o]}))}},931:function(t,e,n){async function r(){if(!("requestMIDIAccess"in navigator))return[];let{inputs:t}=await navigator.requestMIDIAccess();return Array.from(t.values())}n.d(e,{$:function(){return o},r:function(){return r}});class o{noteOn(t){var e,n,r,o;this.notes.add(t),null===(n=(e=this.callback).noteChanged)||void 0===n||n.call(e,t),null===(o=(r=this.callback).noteOn)||void 0===o||o.call(r,t)}noteOff(t){var e,n,r,o;this.notes.delete(t),null===(n=(e=this.callback).noteChanged)||void 0===n||n.call(e,t),null===(o=(r=this.callback).noteOff)||void 0===o||o.call(r,t)}pedal(t,e){var n,r,o,l;let c=this.pedals.has(t),a=e>0;a!==c&&(this.pedals[a?"add":"delete"](t),null===(r=(n=this.callback).pedalChanged)||void 0===r||r.call(n,t),null===(l=(o=this.callback)[a?"pedalOn":"pedalOff"])||void 0===l||l.call(o,t))}clear(){this.notes.clear(),this.pedals.clear()}constructor(t={}){this.callback=t,this.notes=new Set,this.pedals=new Set}}},7771:function(t,e,n){n.d(e,{Vr:function(){return i},D_:function(){return s},tm:function(){return u},dW:function(){return f},Vg:function(){return c}});let r=t=>({get(e,n){if("string"==typeof n){let r=parseInt(n),o=e[(r%t+t)%t];if(null!=o)return o}return e[n]}}),o=Object.fromEntries(Object.entries({sharp:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],flat:["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"]}).map(t=>{let[e,n]=t;return[e,new Proxy(n,r(12))]})),l=Array.from({length:12},(t,e)=>7*e%12),c={major:l.map(t=>o[t<=6?"sharp":"flat"]),dominant:l.map(t=>o[(t+11)%12<=6?"sharp":"flat"]),minor:l.map(t=>o[(t+10)%12<=6?"sharp":"flat"])},a=t=>t.map((e,n)=>t.map((t,e,r)=>r[(e+n)%r.length]+(e+n>=r.length?12:0))),i={power:a([0,7]),major:a([0,4,7]),minor:a([0,3,7])},u=Object.keys(i),s={power:"5",major:"",minor:"m"},f=["基本形","第一転回形","第二転回形"]},541:function(t,e,n){n.d(e,{BH:function(){return a},YD:function(){return u},II:function(){return l},fw:function(){return s},p6:function(){return h},TY:function(){return f}});let r=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return n=>{if(1+e.length!==n.size)return null;let r=Math.min(...n.values());return t%12==r%12&&e.every(t=>n.has(r+t))}};var o=n(7771);function l(){let t=0,e="major",n=0;return function(){0===t&&(e=.5>Math.random()?"major":"minor",n=12*Math.random()|0);let l=o.Vr[e][t].map(t=>n+t),c=o.Vg[e],a=c[n][n]+o.D_[e],i={prompt:"".concat(a," (").concat(o.dW[t],")"),check:r(l[0],l.slice(1).map(t=>t-l[0])),solution:l};return t=(t+1)%3,i}}let c=t=>t[Math.random()*t.length|0],a=()=>{let t=c(["major","minor"]),e=Math.random()*o.Vr[t].length|0;return{ctype:t,base:12*Math.random()|0,iinv:e}},i=o.tm.flatMap(t=>o.Vr[t].map((e,n)=>({ctype:t,iinv:n}))),u=t=>{let{base:e,cinv:n}=t,r=null==e||0===e.length?()=>12*Math.random()|0:()=>c(e),o=null==n||0===n.length?i:n,l=()=>c(o);return function(){return{base:r(),...l()}}};function s(t,e){return function(){let{ctype:n,base:l,iinv:c}=e(),a=o.Vg["power"===n?.5>Math.random()?"major":"minor":n][l],i=o.Vr[n][c].map(t=>l+t),u=a[l]+o.D_[n],s="order"===t?"".concat(u," (").concat(o.dW[c],")"):"root"===t?0===c?u:"".concat(u,"/").concat(a[i[0]]):"".concat(u," (最高音: ").concat(a[i[i.length-1]],")");return{prompt:s,check:r(i[0],i.slice(1).map(t=>t-i[0])),solution:i}}}let f={prompt:"",check:()=>null,solution:[]},h=[{value:"order",label:"和音記号 (第X転回形)"},{value:"root",label:"和音記号/ルート"},{value:"highest",label:"和音記号 (最高音)"}]}}]);